<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Сканер штрих-кода и корзина</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; color: #333; }
  h1 { text-align: center; color: #2c3e50; }
  #video { width: 100%; max-width: 400px; border-radius: 8px; display: block; margin: 10px auto; background:#000; }
  #products, #cart { max-width: 400px; margin: 20px auto; background: white; border-radius: 8px; padding: 15px; box-shadow: 0 3px 6px rgba(0,0,0,0.1);}
  #cart ul { list-style: none; padding: 0; }
  #cart li { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
  button { background: #3498db; border: none; padding: 10px 15px; color: white; border-radius: 5px; cursor: pointer; }
  button:disabled { background: #7f8c8d; cursor: default; }
  #message { text-align: center; font-size: 1.2em; color: green; margin: 15px; }
</style>
</head>
<body>

<h1>Сканер штрих-кода</h1>
<video id="video" autoplay muted playsinline></video>
<div id="message"></div>

<div id="cart" style="display:none;">
  <h2>Корзина</h2>
  <ul id="cart-list"></ul>
  <button id="pay-btn">Оплатить</button>
</div>

<script src="https://unpkg.com/@zxing/library@0.18.6"></script>
<script>
  const products = {
    "123456789012": "Салат цезарь",
    "987654321098": "Куриный шницель с картошкой",
    "135790246813": "Сендвич с курицей",
    "246801357924": "Том ям",
    "112233445566": "Рамен"
  };

  let cart = {};
  let codeReader = null;
  let scanning = true;

  const video = document.getElementById('video');
  const messageDiv = document.getElementById('message');
  const cartDiv = document.getElementById('cart');
  const cartList = document.getElementById('cart-list');
  const payBtn = document.getElementById('pay-btn');

  function updateCartUI() {
    cartList.innerHTML = '';
    for(let code in cart) {
      let li = document.createElement('li');
      li.textContent = products[code] + ` (x${cart[code]})`;
      
      // Remove button
      let btnRemove = document.createElement('button');
      btnRemove.textContent = 'Удалить';
      btnRemove.style.background = '#e74c3c';
      btnRemove.style.marginLeft = '10px';
      btnRemove.onclick = () => {
        delete cart[code];
        if(Object.keys(cart).length === 0) {
          cartDiv.style.display = 'none';
        }
        updateCartUI();
      };
      li.appendChild(btnRemove);
      cartList.appendChild(li);
    }
    if(Object.keys(cart).length > 0) {
      cartDiv.style.display = 'block';
      payBtn.disabled = false;
    } else {
      cartDiv.style.display = 'none';
    }
  }

  payBtn.addEventListener('click', () => {
    scanning = false;
    messageDiv.textContent = "Оплата прошла, Приятного аппетита";
    cart = {};
    updateCartUI();
    setTimeout(() => {
      messageDiv.textContent = "";
      scanning = true;
      startScanner();
    }, 5000);
  });

  function startScanner() {
    if (!scanning) return;
    codeReader = new ZXing.BrowserBarcodeReader();
    codeReader.decodeFromVideoDevice(null, video, (result, err) => {
      if (result) {
        let code = result.text;
        if(products[code]) {
          cart[code] = (cart[code] || 0) + 1;
          updateCartUI();
          messageDiv.textContent = `Добавлен товар: ${products[code]}`;
        } else {
          messageDiv.textContent = `Товар с кодом ${code} не найден`;
        }
      }
      if (err && !(err instanceof ZXing.NotFoundException)) {
        console.error(err);
      }
    });
  }

  startScanner();

</script>

</body>
</html>
